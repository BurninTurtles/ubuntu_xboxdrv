# xboxdrv.conf
# Please, DO NOT EDIT THIS FILE. Edit /etc/defaults/xboxdrv

start on filesystem
pre-start script
    rm -f /dev/input/js*
    # Edit /etc/default/xboxdrv to change these options
    FORCE_FEEDBACK=false
    MIMIC_XPAD=true
    TRIGGER_AS_BUTTON=true
    XBOXDRV_OPTIONS=""
    CONTROLLER0_OPTIONS=""
    CONTROLLER1_OPTIONS=""
    CONTROLLER2_OPTIONS=""
    CONTROLLER3_OPTIONS=""
    XBOXDRV_INSTANCES=1
    # Read configuration variable file if it is present
    if [ -f /etc/default/xboxdrv ] ; then
        . /etc/default/xboxdrv
    fi
    # This will store all pad options from /etc/default/xboxdrv
    PAD_OPTIONS=""
    # Checking if user has enabled forcefeedback
    if [ "$FORCE_FEEDBACK" = true ] ; then
        PAD_OPTIONS="$PAD_OPTIONS --force-feedback"
    fi
    # Checking if user has enabled mimic_xpad
    if [ "$MIMIC_XPAD" = true ] ; then
        PAD_OPTIONS="$PAD_OPTIONS --mimic-xpad --mimic-xpad-wireless"
    fi
    # Checking if user is using trigger as buttons instead of zaxis
    if [ "$TRIGGER_AS_BUTTON" = true ] ; then
        PAD_OPTIONS="$PAD_OPTIONS --trigger-as-button"
    fi
    # Adding --detache-kernel-driver
    PAD_OPTIONS="$PAD_OPTIONS --detach-kernel-driver"
    
    #places all args in a job-global container
    env XBOXDRV_ARGS="--daemon --silent --dbus disabled $XBOXDRV_OPTIONS $PAD_OPTIONS $CONTROLLER0_OPTIONS --next-controller $CONTROLLER1_OPTIONS --next-controller $CONTROLLER2_OPTIONS--next-controller $CONTROLLER3_OPTIONS"
    export XBOXDRV_ARGS
    #loop creates instances from 1 to instance variable
    for icount in $(seq 1 $XBOXDRV_INSTANCES); do
        start xboxdrv-controller id=$icount ARGS="$XBOXDRV_ARGS"
    done
end script

#maybe will use later?
#post-stop script
#    for inst in $(seq 1 $XBOXDRV_INSTANCES); do
#        stop xboxdrv-controller id=$inst
#    done
#end script
