# xboxdrv.conf
# Please, DO NOT EDIT THIS FILE. Edit /etc/defaults/xboxdrv
start on filesystem
pre-start script
    rm -f /dev/input/js*
end script
script
    # Edit /etc/default/xboxdrv to change these options
    FORCE_FEEDBACK=false
    MIMIC_XPAD=true
    TRIGGER_AS_BUTTON=true
    XBOXDRV_OPTIONS=""
    SEPERATE_CONTROLLER_SLOT_OPTIONS=false
    CONTROLLER0_OPTIONS=""
    CONTROLLER1_OPTIONS=""
    CONTROLLER2_OPTIONS=""
    CONTROLLER3_OPTIONS=""
    # Read configuration variable file if it is present
    if [ -f /etc/default/xboxdrv ] ; then
        . /etc/default/xboxdrv
    fi
    # This will store all options to be called after xboxdrv
    COMMAND_OPTIONS="--daemon --silent --dbus disabled"
    # This will store all pad options from /etc/default/xboxdrv
    # with their own triggers.
    PAD_OPTIONS=""
    # Checking if user has enabled forcefeedback
    if [ "$FORCE_FEEDBACK" = true ] ; then
        PAD_OPTIONS="$PAD_OPTIONS --force-feedback"
    fi
    # Checking if user has enabled mimic_xpad
    if [ "$MIMIC_XPAD" = true ] ; then
        PAD_OPTIONS="$PAD_OPTIONS --mimic-xpad --mimic-xpad-wireless"
    fi
    # Checking if user is using trigger as buttons instead of zaxis
    if [ "$TRIGGER_AS_BUTTON" = true ] ; then
        PAD_OPTIONS="$PAD_OPTIONS --trigger-as-button"
    fi
    # Adding --detache-kernel-driver
    PAD_OPTIONS="$PAD_OPTIONS --detach-kernel-driver"

    # final if
    # it will either add and set each controller slots options along 
    # with PAD_OPTIONS or default to just adding PAD_OPTIONS for
    # each controller slot. WARNING: options may interfere.
    
    # Checking if user wants to use seperate options for each 
    # controller slot
    if [ "$SEPERATE_CONTROLLER_SLOT_OPTIONS" = true ] ; then 
        # Checking for controller slot 0 options
        if [ "$CONTROLLER0_OPTIONS" ] ; then 
            COMMAND_OPTIONS="$COMMAND_OPTIONS $CONTROLLER0_OPTIONS $PAD_OPTIONS"
        fi
        # Checking for controller slot 1 options
        if [ "$CONTROLLER1_OPTIONS" ] ; then 
            COMMAND_OPTIONS="--next-controller $COMMAND_OPTIONS $CONTROLLER1_OPTIONS $PAD_OPTIONS"
        fi
        # Checking for controller slot 2 options
        if [ "$CONTROLLER2_OPTIONS" ] ; then 
            COMMAND_OPTIONS="--next-controller $COMMAND_OPTIONS $CONTROLLER2_OPTIONS $PAD_OPTIONS"
        fi
        # Checking for controller slot 3 options
        if [ "$CONTROLLER3_OPTIONS" ] ; then 
            COMMAND_OPTIONS="--next-controller $COMMAND_OPTIONS $CONTROLLER3_OPTIONS $PAD_OPTIONS"
        fi
    else
        # Defaulting to adding the same options for 4 controller slots
        COMMAND_OPTIONS="$COMMAND_OPTIONS $XBOXDRV_OPTIONS $PAD_OPTIONS --next-controller $PAD_OPTIONS --next-controller $PAD_OPTIONS --next-controller $PAD_OPTIONS"
    fi
    # Calling the driver with all commands
    xboxdrv $COMMAND_OPTIONS
end script
